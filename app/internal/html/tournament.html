<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tournaments | Cricket Auction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fc;
            font-family: 'Poppins', sans-serif;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s ease-in-out;
        }
        .card:hover {
            transform: translateY(-6px);
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 10px;
            font-weight: 500;
        }
        .status-upcoming {
            background-color: #0d6efd;
            color: white;
        }
        .status-ongoing {
            background-color: #ffc107;
            color: black;
        }
        .status-completed {
            background-color: #198754;
            color: white;
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <h1 class="text-center mb-4 text-primary fw-bold">üèè Cricket Tournaments</h1>
    <div id="tournament-list" class="row g-4 justify-content-center">
        <!-- Dynamic cards will load here -->
    </div>
</div>

<script>
async function loadTournaments() {
    try {
        const res = await fetch("http://127.0.0.1:8000/api/v1/admin/tournaments/fetch");
        const tournaments = await res.json();

        //<------- Get auction status if live then i will show the live button-------------->
        const statusRes = await fetch("http://127.0.0.1:8000/api/v1/auction/status");
        const auctionStatus = await statusRes.json();
        const activeTournament = auctionStatus.active_tournament;
        const isLive = auctionStatus.is_live;

        const container = document.getElementById("tournament-list");
        container.innerHTML = "";

        if (tournaments.length === 0) {
            container.innerHTML = "<p class='text-center text-muted'>No tournaments available.</p>";
            return;
        }

        tournaments.forEach(t => {
            const div = document.createElement("div");
            div.className = "col-md-4 col-sm-6";

            // Check if this tournament is live
            const showLiveButton = isLive && activeTournament === t.id;

            div.innerHTML = `
                <div class="card p-4 text-center">
                    <h5 class="fw-bold text-primary">${t.name}</h5>
                    <p><strong>Year:</strong> ${t.year}</p>
                    <p><strong>Start:</strong> ${t.start_date}</p>
                    <p><strong>End:</strong> ${t.end_date}</p>
                    <span class="status-badge status-${t.status}">
                        ${t.status.charAt(0).toUpperCase() + t.status.slice(1)}
                    </span>
                    <div class="d-grid gap-2 mt-3">
                        ${showLiveButton ? `<button class="btn btn-success" onclick="joinLiveAuction(${t.id})">üèÅ Live Auction</button>` : ""}
                        <button class="btn btn-outline-primary" onclick="viewTeams(${t.id}, '${t.name}')">üë• More Information</button>
                    </div>
                </div>
            `;
            container.appendChild(div);
        });
    } catch (err) {
        console.error("Error fetching tournaments:", err);
    }
}

function joinLiveAuction(tournamentId) {
    // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßÅ‡¶Æ‡¶ø WebSocket join ‡¶¨‡¶æ redirect ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßã live auction page ‡¶è
    window.location.href = `/live-auction.html?tournament_id=${tournamentId}`;
}

function viewTeams(id, name) {
    window.location.href = `/home/yasin/all_program/cpl/app/internal/html/tournament_summery.html?tournament_id=${id}&tournament_name=${encodeURIComponent(name)}`;
}

loadTournaments();

</script>

</body>
</html>
