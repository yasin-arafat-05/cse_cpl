<!-- admin/team_create.html -->
<!DOCTYPE html>
<html>
<head>
  <title>Team Create | Admin Panel</title>
  <link rel="stylesheet" href="assets/style.css">
</head>
<body>
<div class="container">
  <div class="heading">নতুন Team তৈরি করুন</div>
  <form id="teamForm">
    <div class="form-group">
      <label for="tournamentSelect">Tournament:</label>
      <select id="tournamentSelect"></select>
    </div>
    <div class="form-group">
      <label for="team_name">Team Name:</label>
      <input type="text" id="team_name" name="team_name" required>
    </div>
    <div class="form-group">
      <label for="team_code">Team Code:</label>
      <input type="text" id="team_code" name="team_code" required>
    </div>
    <div class="form-group">
      <label for="token">Admin Token:</label>
      <input type="text" id="token" name="token" placeholder="(Bearer ...)" required>
    </div>
    <button type="submit">Create Team</button>
  </form>
  <div id="teamResult"></div>
  <hr>
  <button onclick="window.location='index.html'">Back</button>
</div>
<script src="assets/utils.js"></script>
<script>
// Load tournaments
async function loadTournaments() {
  const res = await apiFetch('/api/v1/admin/tournaments/fetch', {headers:{'accept':'application/json'}});
  const sel = document.getElementById('tournamentSelect');
  sel.innerHTML = '';
  if (!res.ok) { sel.innerHTML = `<option value=''>লোড হয়নি</option>`; return; }
  const data = await res.json();
  if (!data.length) { sel.innerHTML = `<option value=''>Empty</option>`; return; }
  data.forEach(t => {
    const o = document.createElement('option');
    o.value = t.id;
    o.textContent = t.name+' ('+t.year+')';
    sel.appendChild(o);
  });
}
window.onload = loadTournaments;
document.getElementById('teamForm').onsubmit = async function(e) {
  e.preventDefault();
  const tid = document.getElementById('tournamentSelect').value;
  const name = document.getElementById('team_name').value.trim();
  const code = document.getElementById('team_code').value.trim();
  const token = document.getElementById('token').value.trim();
  if (!tid || !name || !code || !token) return;
  const res = await apiFetch('/api/v1/admin/teams',{
    method: 'POST',
    headers: {
      'accept':'application/json',
      'Authorization': token,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({tournament_id: Number(tid), team_name: name, team_code: code})
  });
  if (res.ok) {
    document.getElementById('teamResult').innerHTML = '<span class="success">Team created!</span>';
  } else {
    document.getElementById('teamResult').innerHTML = '<span class="error">Failed ('+res.status+')</span>';
  }
}
</script>
</body>
</html>
